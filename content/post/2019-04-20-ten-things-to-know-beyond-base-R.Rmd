---
title: "Ten things to know beyond base R"
author: kearneymw
date: '2019-04-20'
categories:
  - rstats
tags:
  - R
  - tidyverse
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo = TRUE, 
  comment = "#>", 
  collapse = TRUE,
  fig.show = "hide"
)
options(tibble.print_min = 5)
options(tibble.print_max = 5)
```

## 1. The pipe

The _pipe_ refers to the `%>%` operator from the [{magrittr}](https://tidyverse.org/magrittr) package.

```{r}
library(magrittr)
```

It may seem complicated at first, but what the pipe does is actually quite simple. That is, **it allows users to write linear code**. To illustrate use of the pipe, consider the following code that takes the mean of the log of three numbers:

```{r}
mean(log(c(1, 3, 9)))
```

Notice how the numbers `c(1, 3, 9)` are nested inside the `log()` function, which is then nested inside the `mean()` function? So, if you're reading the code from left-to-right, it means the _functions are performed in reverse order from how they are written_. If we broke the code down into its three functions, we would actually expect the order of operations to proceed as follows:

+ **(1)** Concacenate numbers into vector `c(...)`
+ **(2)** Log the numeric vector `log(...)`
+ **(3)** Estimate the mean of the logged numeric vector `mean(...)`

With this order of operations in mind, now consider the following **piped** code, which takes a numeric vector `c(1, 3, 9)`, calculates the `log()`, and then estimates the `mean()`. Hopefully you notice that, in contrast to the nested code above, the code below is linear; in other words, the code appears in the same order as the operations are performed.

```{r}
c(1, 3, 9) %>%
  log() %>%
  mean()
```

## 2. The tibble

R is my favorite programming language because nearly everyone who uses it either works with data frames or is very familiar with them. With all of this use and attention, it is hardly surprising then that there would be some minor improvements to the traditional `data.frame`. And that's exactly what the [{tibble}](https://tidyverse.org/tibble) package does. Tibbles (class `tbl_df`) are a special kind of data frame that have desirable properties for printing and joining. And because they inherit the `data.frame` class, they also behave like data frames 99.9% (and, seriously, I wouldn't worry about the .1%).

```{r}
(mtcars <- tibble::as_tibble(mtcars))
```


## 3. Select, filter, arrange

The most basic [{dplyr}](https://tidyverse.org/dplyr) functions allow users to easily **select columns**,

```{r}
dplyr::select(mtcars, cyl, wt, mpg, gear)
```

**filter rows**,

```{r}
dplyr::filter(mtcars, cyl == 4, mpg >= 10)
```

and **arrange rows**.

```{r}
dplyr::arrange(mtcars, dplyr::desc(mpg))
```

Chain these functions together with the pipe operator `%>%` to achieve linear/tidyverse-style excellence.

```{r}
mtcars %>%
  dplyr::filter(gear == 4) %>%
  dplyr::select(cyl, wt, mpg) %>%
  dplyr::arrange(mpg)
```

## 4. Mutate variables

For data wrangling, use `dplyr::mutate()` to easily transform and/or add new variables to an existing data frame.

```{r}
mtcars %>%
  dplyr::mutate(mpg_per_cyl = mpg / cyl,
    car = row.names(mtcars)) %>%
  dplyr::select(car, mpg, cyl, mpg_per_cyl)
```


## 5. Group and summarise

Use `dplyr::group_by()` to set the unit of analysis–i.e., groups–and then `dplyr::summarise()` to perform calculations that describe that level of analysis.

```{r}
mtcars %>%
  dplyr::group_by(cyl) %>%
  dplyr::summarise(
    n = dplyr::n(),
    wt = mean(wt, na.rm = TRUE),
    mpg = mean(mpg, na.rm = TRUE),
    gear = median(gear, na.rm = TRUE)
  )
```

## 6. Join and bind

```{r}
newdata <- tibble::tibble(
  cyl = c(4, 6, 8),
  avg_wt = c(2.5, 3.0, 3.5)
)
dplyr::left_join(mtcars, newdata)
```


## 7. Grammar of graphics

```{r}
ggplot2::ggplot(mtcars, ggplot2::aes(x = wt, y = mpg)) +
  ggplot2::geom_point()
```

## 8. Map functions

```{r}
list(mtcars, women, airquality) %>%
  purrr::map(dim)

list(mtcars, women, airquality) %>%
  purrr::map_int(ncol)
```


<!-- <p style="align:center"> <img src="/img/network-benchmark.png"> </p> -->


## Notes

<sup>1</sup> Data I used to generate the example data set:
