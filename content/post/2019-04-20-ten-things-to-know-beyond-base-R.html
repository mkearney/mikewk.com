---
title: "Ten things to know beyond base R"
author: kearneymw
date: '2019-04-20'
categories:
  - rstats
tags:
  - R
  - tidyverse
---



<div id="the-pipe" class="section level2">
<h2>1. The pipe</h2>
<p>The <em>pipe</em> refers to the <code>%&gt;%</code> operator from the <a href="https://tidyverse.org/magrittr">{magrittr}</a> package.</p>
<pre class="r"><code>library(magrittr)</code></pre>
<p>It may seem complicated at first, but what the pipe does is actually quite simple. That is, <strong>it allows users to write linear code</strong>. To illustrate use of the pipe, consider the following code that takes the mean of the log of three numbers:</p>
<pre class="r"><code>mean(log(c(1, 3, 9)))
#&gt; [1] 1.098612</code></pre>
<p>Notice how the numbers <code>c(1, 3, 9)</code> are nested inside the <code>log()</code> function, which is then nested inside the <code>mean()</code> function? So, if you’re reading the code from left-to-right, it means the <em>functions are performed in reverse order from how they are written</em>. If we broke the code down into its three functions, we would actually expect the order of operations to proceed as follows:</p>
<ul>
<li><strong>(1)</strong> Concacenate numbers into vector <code>c(...)</code></li>
<li><strong>(2)</strong> Log the numeric vector <code>log(...)</code></li>
<li><strong>(3)</strong> Estimate the mean of the logged numeric vector <code>mean(...)</code></li>
</ul>
<p>With this order of operations in mind, now consider the following <strong>piped</strong> code, which takes a numeric vector <code>c(1, 3, 9)</code>, calculates the <code>log()</code>, and then estimates the <code>mean()</code>. Hopefully you notice that, in contrast to the nested code above, the code below is linear; in other words, the code appears in the same order as the operations are performed.</p>
<pre class="r"><code>c(1, 3, 9) %&gt;%
  log() %&gt;%
  mean()
#&gt; [1] 1.098612</code></pre>
</div>
<div id="the-tibble" class="section level2">
<h2>2. The tibble</h2>
<p>R is my favorite programming language because nearly everyone who uses it either works with data frames or is very familiar with them. With all of this use and attention, it is hardly surprising then that there would be some minor improvements to the traditional <code>data.frame</code>. And that’s exactly what the <a href="https://tidyverse.org/tibble">{tibble}</a> package does. Tibbles (class <code>tbl_df</code>) are a special kind of data frame that have desirable properties for printing and joining. And because they inherit the <code>data.frame</code> class, they also behave like data frames 99.9% (and, seriously, I wouldn’t worry about the .1%).</p>
<pre class="r"><code>(mtcars &lt;- tibble::as_tibble(mtcars))
#&gt; # A tibble: 32 x 11
#&gt;     mpg   cyl  disp    hp  drat    wt  qsec    vs    am  gear  carb
#&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
#&gt; 1  21       6   160   110  3.9   2.62  16.5     0     1     4     4
#&gt; 2  21       6   160   110  3.9   2.88  17.0     0     1     4     4
#&gt; 3  22.8     4   108    93  3.85  2.32  18.6     1     1     4     1
#&gt; 4  21.4     6   258   110  3.08  3.22  19.4     1     0     3     1
#&gt; 5  18.7     8   360   175  3.15  3.44  17.0     0     0     3     2
#&gt; # … with 27 more rows</code></pre>
</div>
<div id="select-filter-arrange" class="section level2">
<h2>3. Select, filter, arrange</h2>
<p>The most basic <a href="https://tidyverse.org/dplyr">{dplyr}</a> functions allow users to easily <strong>select columns</strong>,</p>
<pre class="r"><code>dplyr::select(mtcars, cyl, wt, mpg, gear)
#&gt; # A tibble: 32 x 4
#&gt;     cyl    wt   mpg  gear
#&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
#&gt; 1     6  2.62  21       4
#&gt; 2     6  2.88  21       4
#&gt; 3     4  2.32  22.8     4
#&gt; 4     6  3.22  21.4     3
#&gt; 5     8  3.44  18.7     3
#&gt; # … with 27 more rows</code></pre>
<p><strong>filter rows</strong>,</p>
<pre class="r"><code>dplyr::filter(mtcars, cyl == 4, mpg &gt;= 10)
#&gt; # A tibble: 11 x 11
#&gt;     mpg   cyl  disp    hp  drat    wt  qsec    vs    am  gear  carb
#&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
#&gt; 1  22.8     4 108      93  3.85  2.32  18.6     1     1     4     1
#&gt; 2  24.4     4 147.     62  3.69  3.19  20       1     0     4     2
#&gt; 3  22.8     4 141.     95  3.92  3.15  22.9     1     0     4     2
#&gt; 4  32.4     4  78.7    66  4.08  2.2   19.5     1     1     4     1
#&gt; 5  30.4     4  75.7    52  4.93  1.62  18.5     1     1     4     2
#&gt; # … with 6 more rows</code></pre>
<p>and <strong>arrange rows</strong>.</p>
<pre class="r"><code>dplyr::arrange(mtcars, dplyr::desc(mpg))
#&gt; # A tibble: 32 x 11
#&gt;     mpg   cyl  disp    hp  drat    wt  qsec    vs    am  gear  carb
#&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
#&gt; 1  33.9     4  71.1    65  4.22  1.84  19.9     1     1     4     1
#&gt; 2  32.4     4  78.7    66  4.08  2.2   19.5     1     1     4     1
#&gt; 3  30.4     4  75.7    52  4.93  1.62  18.5     1     1     4     2
#&gt; 4  30.4     4  95.1   113  3.77  1.51  16.9     1     1     5     2
#&gt; 5  27.3     4  79      66  4.08  1.94  18.9     1     1     4     1
#&gt; # … with 27 more rows</code></pre>
<p>Chain these functions together with the pipe operator <code>%&gt;%</code> to achieve linear/tidyverse-style excellence.</p>
<pre class="r"><code>mtcars %&gt;%
  dplyr::filter(gear == 4) %&gt;%
  dplyr::select(cyl, wt, mpg) %&gt;%
  dplyr::arrange(mpg)
#&gt; # A tibble: 12 x 3
#&gt;     cyl    wt   mpg
#&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
#&gt; 1     6  3.44  17.8
#&gt; 2     6  3.44  19.2
#&gt; 3     6  2.62  21  
#&gt; 4     6  2.88  21  
#&gt; 5     4  2.78  21.4
#&gt; # … with 7 more rows</code></pre>
</div>
<div id="mutate-variables" class="section level2">
<h2>4. Mutate variables</h2>
<p>For data wrangling, use <code>dplyr::mutate()</code> to easily transform and/or add new variables to an existing data frame.</p>
<pre class="r"><code>mtcars %&gt;%
  dplyr::mutate(mpg_per_cyl = mpg / cyl,
    car = row.names(mtcars)) %&gt;%
  dplyr::select(car, mpg, cyl, mpg_per_cyl)
#&gt; # A tibble: 32 x 4
#&gt;   car     mpg   cyl mpg_per_cyl
#&gt;   &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt;       &lt;dbl&gt;
#&gt; 1 1      21       6        3.5 
#&gt; 2 2      21       6        3.5 
#&gt; 3 3      22.8     4        5.7 
#&gt; 4 4      21.4     6        3.57
#&gt; 5 5      18.7     8        2.34
#&gt; # … with 27 more rows</code></pre>
</div>
<div id="group-and-summarise" class="section level2">
<h2>5. Group and summarise</h2>
<p>Use <code>dplyr::group_by()</code> to set the unit of analysis–i.e., groups–and then <code>dplyr::summarise()</code> to perform calculations that describe that level of analysis.</p>
<pre class="r"><code>mtcars %&gt;%
  dplyr::group_by(cyl) %&gt;%
  dplyr::summarise(
    n = dplyr::n(),
    wt = mean(wt, na.rm = TRUE),
    mpg = mean(mpg, na.rm = TRUE),
    gear = median(gear, na.rm = TRUE)
  )
#&gt; # A tibble: 3 x 5
#&gt;     cyl     n    wt   mpg  gear
#&gt;   &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
#&gt; 1     4    11  2.29  26.7     4
#&gt; 2     6     7  3.12  19.7     4
#&gt; 3     8    14  4.00  15.1     3</code></pre>
</div>
<div id="join-and-bind" class="section level2">
<h2>6. Join and bind</h2>
<pre class="r"><code>newdata &lt;- tibble::tibble(
  cyl = c(4, 6, 8),
  avg_wt = c(2.5, 3.0, 3.5)
)
dplyr::left_join(mtcars, newdata)
#&gt; Joining, by = &quot;cyl&quot;
#&gt; # A tibble: 32 x 12
#&gt;     mpg   cyl  disp    hp  drat    wt  qsec    vs    am  gear  carb avg_wt
#&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
#&gt; 1  21       6   160   110  3.9   2.62  16.5     0     1     4     4    3  
#&gt; 2  21       6   160   110  3.9   2.88  17.0     0     1     4     4    3  
#&gt; 3  22.8     4   108    93  3.85  2.32  18.6     1     1     4     1    2.5
#&gt; 4  21.4     6   258   110  3.08  3.22  19.4     1     0     3     1    3  
#&gt; 5  18.7     8   360   175  3.15  3.44  17.0     0     0     3     2    3.5
#&gt; # … with 27 more rows</code></pre>
</div>
<div id="grammar-of-graphics" class="section level2">
<h2>7. Grammar of graphics</h2>
<pre class="r"><code>ggplot2::ggplot(mtcars, ggplot2::aes(x = wt, y = mpg)) +
  ggplot2::geom_point()</code></pre>
</div>
<div id="map-functions" class="section level2">
<h2>8. Map functions</h2>
<pre class="r"><code>list(mtcars, women, airquality) %&gt;%
  purrr::map(dim)
#&gt; [[1]]
#&gt; [1] 32 11
#&gt; 
#&gt; [[2]]
#&gt; [1] 15  2
#&gt; 
#&gt; [[3]]
#&gt; [1] 153   6

list(mtcars, women, airquality) %&gt;%
  purrr::map_int(ncol)
#&gt; [1] 11  2  6</code></pre>
<!-- <p style="align:center"> <img src="/img/network-benchmark.png"> </p> -->
</div>
<div id="notes" class="section level2">
<h2>Notes</h2>
<p><sup>1</sup> Data I used to generate the example data set:</p>
</div>
